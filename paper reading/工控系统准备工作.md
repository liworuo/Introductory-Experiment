# 工业控制系统数据驱动的入侵检测研究

## 本文阅读简要要点

针对入侵检测 (Intrusion detection) 在工控系统 (Industrial Control System) 的工作

### 问题

1. 数据集数量有限，过程数据不足，类型不全，样本不均
2. 两种入侵检测的缺陷：
   1. 基于**误用**的入侵检测：未知攻击不检测
   2. 基于**异常**的入侵检测：建模难
3. 在线部署的入侵检测系统数量有限

### 解决方法

7 类攻击数据集、4 种基于机器学习的入侵检测模型、构成在线系统

- 在真实的乙醇精馏系统上，包括了多种攻击 (信息侧面攻击)
  - 方面：网络通信、数据隐私、系统运行
  - 不同攻击阶段：覆盖接入网络、解析通信、信息物理映射、直接接触
- 入侵检测系统建模难，改成分类问题，建立二分类机器学习方法
- 实时检测系统
  - 获取上位机与可编程逻辑控制器 (Programmable Logic Controller，PLC) 间通信数据包
  - 子模块进行入侵检测，子模块投票产生
  - 报警、控制恢复

## 学习要点

### 工控系统 (Industrial Control System, ICS)

典型结构：

- **企业层**：包括企业资源计划 (Enterprise Resource Planning，ERP)、产品生命周期管理 (Product Lifecycle Management，PLM)
  - 与外部网络直接进行信息交互，优化企业资源分配，管理产品生命周期
- **管理层**：包括仓库管理系统 (WarehouseManagement System，WMS)、制造执行系统 (Manufacturing Execution System，MES)
  - 由企业层管理，负责仓库的管理调度和车间生产管理
- **操作层**：操作员站 (OperatorStation)、历史站 (HistoryStation) 和工程师站 (Engineer Station)
  - 操作员站进行远程操作监控
  - 历史站记录历史信息
  - 工程师站具备设备组态、控制逻辑修改等功能
- **控制层**：由人机交互界面 (Human Machine Interface，HMI)、可编程逻辑控制器和远程终端单元 (Remote Terminal Unit，RTU) 等组成
  - 包含操作员站组态完成的控制逻辑，部署于现场，采集现场设备数据，计算并发送控制命令，实现对现场设备的控制
- **现场层**：由机械臂、阀门、泵、传感器等现场设备组成，采集物理信息并传输给控制层，根据控制层传输的命令执行操作。

![工控系统结构图](<工控系统结构图.png>)

### 文献综述内容 (风险与安全)

更新频率，TCP/IP 协议通信本身存在一定的安全漏洞

主被动防御手段主要有边界管控、网络欺骗、漏洞挖掘、入侵检测等

- 边界管控：建立隔离，监控过滤通信数据 (防火墙)
- 网络欺骗：对攻击者的信息进行干预
  - 扭转攻防不对称，浪费攻击者资源 (蜜罐)
- 漏洞挖掘：对自身进行检测、修复
- 入侵检测：对内外的违规行为进行干预

入侵行为的发现是前提，入侵检测技术是 ICS 安全防御的核心技术

### 工控入侵检测实验平台及数据集

问题：

1. 构建成本高，在实体上容易造成损失 (丢包)
2. 黑客 ICS 的攻击多，人工识别工作量大
3. 实体运行是商业机密，公开度低

公开数据集：[23\24\25\26\27\28\29]

- 原水净化数据集
  - 通过篡改传感器数值，达成水溢出目标;通过劫持并注入盐酸泵命令，达成控制 pH 值目标。攻击实施方式为在现场设备和 PLC 之间发起中间人攻击，注入错误传感器数值和控制命令
- 锅炉系统模拟数据集
  - 单点注入和多点注入攻击
  - 单点注入随机选择一个变量并注入其有效范围内的任意数据，多点注入攻击同时在不同数量的随机选择变量上注入错误数据
- 天然气数据集
  - 实验平台 PLC 使用 MODBUS 协议通信
  - **攻击方式**
    - 侦察
    - 响应注入
    - 指令注入
    - 拒绝服务
  - 侦察类攻击包括四种针对 MODBUS 服务器的攻击
    - 地址扫描
    - 功能代码扫描
    - 设备识别攻击
    - 点扫描
  - 响应注入攻击是指篡改服务器到客户端的响应，提供虚假的系统状态的攻击
    - 简单的恶意响应注入将有效负载设置为全零、全一或者随机位
    - 复杂的恶意响应注入的信息更为隐蔽，信息接近于正常运行状态，模拟正常运行的重放和注入预先计算完成的数值
  - 命令注入攻击
    - 恶意状态命令注入攻击、恶意参数命令注入攻击和恶意功能代码命令注入攻击
    - 直接威胁现场设备、篡改控制参数间接影响控制和影响 PLC 内置协议函数
  - 拒绝服务攻击
    - 循环冗余校验（CyclicRedundancyCheck，CRC）攻击
    - MODBUS 主流量干扰攻击
  - 使用串行端口数据记录器捕获数据，网络流量特征和有效负载内容和特征两类数据内容
  - **支持基于网络的入侵检测和基于主机的入侵检测研究**
- 储水箱系统数据集
  - 控制系统使用 RTU 控制，可以使用远程 HMI 监控储水罐。HMI 每两秒轮询一次
  - 攻击设计方法与天然气控制系统方法相同
  - 使用的通信协议为 MODBUS 协议
- 变电控制系统数据集
  - 部分控制使用真实 PLC 控制
  - 使用的 ICS 通信标准包括 IEEEC37.118、MODBUS/TCP、DNP3、通用面向对象变电站事件和 EtherNet/IP
- SWAT 数据集
  - 根据真实工业水处理厂缩小的六阶段水处理系统
  - SWAT 的网络拓扑结构为：使用 PLC 监控传感器信息，PLC 上层为 HMI 和 SCADA
  - 由不同的 PLC 控制，使用 MODBUS/TCP、CIP 通信
  - 结合 SWAT 多阶段特点，将攻击分为单阶段单点攻击、单阶段多点攻击、多阶段单点攻击和多阶段多点攻击
  - SWAT 实验平台具有历史站，物理特性由历史站导出
  - SWAT 数据集不包含信息泄露、控制参数等方面的攻击
- WADI 数据集
  - WADI 使用 PLC 和 RTU 共同控制，使用 MODBUS/TCP、CIP 通信
  - 实现停止向用户供水、阻止主网格向次网格供水等目标为导向，设计改变主电网水位传感器和水电导率仪的读数、升高的储罐传感器、关闭用户储罐阀门等不同攻击
  - 数据集生成方式为从历史站导出数据并人工制作标签
- EPIC 数据集
  - EPIC 的数据由数据包物理数据两部分组成，数据包以 pacp 格式存储，物理数据由 csv 格式存储

![数据集](<数据集.png>)

### 入侵检测方法

网络流量、安全日志、审计数据和计算机系统关键点信息

入侵检测方法进行分类

![alt text](<ICS中的分类.png>)

基于知识的入侵检测，也被称为基于签名或基于误用的入侵检测

基于行为的入侵检测技术也被称为基于异常的入侵检测

#### 基于知识的入侵检测方法

通过寻找**某些运行时特征**来识别异常行为

## 论文中涉及的专业术语列表

- 工业控制系统 (Industrial Control System, ICS)
- 入侵检测系统 (Intrusion Detection System, IDS)
- 数据驱动 (Data-driven)
- 机器学习 (Machine Learning)
- 乙醇精馏系统 (Ethanol Distillation System, EDS)
- S7COMM 协议 (S7COMM Protocol)
- 可编程逻辑控制器 (Programmable Logic Controller, PLC)
- 上位机
- 企业资源计划 (Enterprise Resource Planning, ERP)
- 产品生命周期管理 (Product Lifecycle Management, PLM)
- 仓库管理系统 (Warehouse Management System, WMS)
- 制造执行系统 (Manufacturing Execution System, MES)
- 操作员站 (Operator Station)
- 历史站 (History Station)
- 工程师站 (Engineer Station)
- 人机交互界面 (Human Machine Interface, HMI)
- 远程终端单元 (Remote Terminal Unit, RTU)
- 传统信息技术 (Information Technology, IT)
- 采集与监视控制系统 (Supervisory Control And Data Acquisition, SCADA)
- 0-day 漏洞
- DUQU 病毒
- 边界管控
- 网络欺骗
- 漏洞挖掘
- 基于误用的入侵检测 (Misuse-based Intrusion Detection)
- 基于异常的入侵检测 (Anomaly-based Intrusion Detection)
- 线性动态状态空间 (Linear Dynamical State-Space, LDS) 模型
- 自回归 (Auto Regressive, AR)
- 卡尔曼滤波器
- LQG 控制器
- 极限控制
- 自联想核回归 (Auto Associative Kernel Regression, AAKR)
- 序贯概率比检验 (Sequential Probability Ratio Test, SPRT)
- 累积和 (Cumulative Sum Control Chart, CUSUM) 算法
- 监督机器学习算法 (Supervised Learning)
- 无监督机器学习算法 (Unsupervised Learning)
- 半监督机器学习算法 (Semi-supervised Learning)
- 密集连接的卷积网络 (Densely connected convolutional networks, DenseNet)
- NearMiss (NM) 欠采样技术 (Undersampling)
- 深度神经网络 (Deep Neural Networks, DNN)
- 分层亲和传播 (Hierarchical Affinity Propagation, HAP) 聚类
- 粒子群方法 (Particle Swarm Optimization, PSO)
- ANN 模型 (Artificial Neural Network, ANN)
- 负选择算法 (Negative Selection Algorithm, NSA)
- 马氏距离
- 卷积神经网络 (Convolutional Neural Network, CNN)
- softmax 分类器
- Bloom 过滤器
- 长短期记忆网络 (Long Short Term Memory, LSTM)
- 朴素贝叶斯 (Naive Bayesian, NB)
- K-最近邻算法 (K Nearest Neighbors, KNN)
- 随机森林 (Random Forest, RF)
- 决策树 (Decision Tree, DT)
- 逻辑回归 (Logistic Regression, LR)
- K-均值算法 (K-Means)
- 自编码器 (Auto-Encoder, AE)
- 预测增强自动编码器 (Prediction-Augmented Autoencoder, PAAE)
- 孤立森林 (Isolation Forest, IF)
- Deep Autoencoding Gaussian Mixture Model (DAGMM)
- 全方位学习 (Omni-supervised learning)
- z-score
- 主成分分析 (Principal Component Analysis, PCA)
- 奇异值分解 (Singular Value Decomposition, SVD)
- 高斯混合模型 (Gaussian Mixed Model, GMM)
- 单类支持向量机 (OneClass SVM, OCSVM)
- 灰狼优化算法
- 一类进化的尖峰神经网络 (evolving spiking neural network, eSNN)
- 高级持久威胁 (Advanced Persistent Threat, APT)
- Min-Max 归一化 (Min-Max Normalization)
- 0 均值标准化 (Z-score Normalization)
- 一阶差分 (First-order Difference)
- 冗余数据处理 (Redundant Data Processing)
- 精确度 (Precision, PRE)
- 召回率 (Recall, TPR)
- F1 值 (F1 Score)
- 真阳性 (True Positive, TP)
- 真阴性 (True Negative, TN)
- 假阳性 (False Positive, FP)
- 假阴性 (False Negative, FN)
- CART (Classification and Regression Tree) 决策树
- 基尼系数 (Gini Index)
- 信息熵 (Information Entropy)
- 信息增益 (Information Gain)
- 网格法调参 (Grid Search)
- XGBoost (eXtreme Gradient Boosting)
- 集成学习 (Ensemble Learning)
- Boosting 方法
- Bagging 方法
- 超平面 (Hyperplane)
- 法向量 (Normal Vector)
- 支持向量 (Support Vectors)
- 间隔 (Margin)
- 优化问题 (Optimization Problem)
- 拉格朗日乘子法 (Lagrange Multiplier)
- 对偶问题 (Dual Problem)
- 核函数 (Kernel Function)
- 径向基函数核 (Radial Basis Function, RBF kernel)
- 高斯核函数 (Gaussian Kernel)
- 线性核 (Linear Kernel)
- 多项式核 (Polynomial Kernel)
- 软间隔 (Soft Margin)
- 时序特征 (Time-series features)
- RNN (Recurrent Neural Network)
- 梯度爆炸 (Exploding Gradients)
- 梯度消失 (Vanishing Gradients)
- 记忆门 (Forget Gate)
- 遗忘门 (Input Gate) - 论文里是遗忘门，但通常 LSTM 的 F-I-O 是遗忘、输入、输出。此处依照论文原文。
- 输出门 (Output Gate)
- Dropout 层
- Modbus 协议
- PID 控制 (Proportional Integral Derivative Control)
- 控制命令注入 (Control Command Injection)
- 传感器数据篡改 (Sensor Data Tampering)
- 控制参数篡改 (Control Parameter Tampering)
- 重放攻击 (Replay Attack)
- 多点位攻击 (Multi-point Attack)
- 物理攻击 (Physical Attack)
- 威胁模型 (Threat Model)
- 攻击向量 (Attack Vector)
- 通信脚本
- python snap7 开源库
- Wireshark
- .pacp (Packet Capture) 文件格式
- TCP/IP 协议
- 协议 ID (Protocol ID)
- ROSCTR (Response/Request Counter，但在这篇论文里可能指 S7COMM Header 的一个字段)
- PDU 参数 (Protocol Data Unit Parameters)
- 功能码 (Function Code)
- 副功能码 (Subfunction Code)
- 系统状态列表读取 (SZL)
- 点位读取
- 强制 (Force)
- 通信状态机 (Communication State Machine)
- 实时检测系统 (Real-time Detection System)
- 检测时延 (Detection Delay)`
